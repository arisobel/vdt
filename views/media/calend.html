{{extend 'layout.html'}}
<h1>Calendário de Publicações de Mídia</h1>
<div class='row-fluid mb-3'>
    <input id='ano_calend' type="month" min="2020" class='calend form-control col-md-3' value='{{=year}}-{{=str(month).zfill(2)}}'>
</div>

{{ stl = "info" }}
{{ class_fundo = ""}}
<div class='row'>
    <div class='col-md-12'>
        <table class='table table-bordered' id="mensal">
            <tr>
                <th width="120">Seg</th>
                <th width="120">Ter</th>
                <th width="120">Qua</th>
                <th width="120">Qui</th>
                <th width="120">Sex</th>
                <th width="120">Sab</th>
                <th width="120">Dom</th>
            </tr>
            {{ for semana in calend:}}
            <tr>
                {{ for dia in semana:}}
                {{if dia:}}
                <td height="120px" class="{{=class_fundo}}">
                    <span class="pull-right">
                        <span class="badge badge-dark">
                            {{=dia}}
                        </span>
                    </span>
                    {{ if dia in dic_media:}}
                        {{for media in dic_media[dia]:}}
                            <div class="media-item mt-2">
                                <a href="{{=URL('toca','index', args=[media['media_video']['id']])}}" 
                                   class="media-link" 
                                   title="{{=media['media_video']['titulo']}}"
                                   target="_blank">
                                    <span class="badge badge-info">
                                        {{=dict_tipos_media.get(media['media_video']['tipo_media'], '-')[:3]}}
                                    </span>
                                    <span class="media-title">
                                        {{=media['media_video']['titulo'][:30]}}{{='...' if len(media['media_video']['titulo']) > 30 else ''}}
                                    </span>
                                </a>
                                {{if media['palestrante'] and media['palestrante']['nome']:}}
                                    <small class="d-block text-muted">{{=media['palestrante']['nome'][:20]}}</small>
                                {{pass}}
                            </div>
                        {{ pass }}
                    {{ pass }}
                </td>
                {{else:}}
                <td></td>
                {{pass}}
                {{ pass }}
            </tr>
            {{ pass }}
        </table>
    </div>
</div>

<script>
$(".calend").on("change", function(){
    var ano_mes = $("#ano_calend").val().split("-");
    var ano = ano_mes[0];
    var mes = ano_mes[1];
    window.location = "{{=URL('media','calend')}}/"+ano+"/"+mes;
});
</script>

<style>
#mensal {
   table-layout: fixed;
}

#mensal td {
  padding: 5px;
  border: 2px solid #deddd9;
  vertical-align: top;
  overflow: hidden;
}

.media-item {
    font-size: 11px;
    border-left: 3px solid #17a2b8;
    padding-left: 5px;
    margin-bottom: 5px;
}

.media-link {
    text-decoration: none;
    color: #333;
}

.media-link:hover {
    color: #007bff;
    text-decoration: none;
}

.media-title {
    display: inline-block;
    vertical-align: middle;
}
</style>
